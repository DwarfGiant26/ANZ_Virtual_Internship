---
title: <center> ANZ Transaction Data Summary</center>
output:
  html_document:
    toc : true
    toc_float : true
    code_folding : hide
---

<style>
  h2{
    font-size: 16pt;
  }
  h3{
    font-size: 12pt;
  }
</style>
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning = FALSE,message = FALSE)
```


# Preparation
```{r,echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(readxl)
library(ggplot2)
library(knitr)
```

Let's take a quick look at our data
```{r,echo=FALSE, warning=FALSE, message=FALSE}
data = read_excel('ANZ synthesised transaction dataset.xlsx')
kable(head(data))
```
```{r}
kable(summary(data))
```
## Dealing with Null values

As we can see there are quite a lot of null values, especially in column merchant_code and bpay_biller_code

There are multiple ways we can resolve this:

1. Drop all rows with null value -> this is the easiest but it will get rid of most of the data

2. Drop all rows with null value in columns that has less null values like card_present_flag -> This is a pretty good solution, but some of our query for this data might not really need this part anyway, so this might just end up sacrificing some of the data for no clear reason.

3. Keep everything, and if we need to query column that has something to do with merchant then we drop it -> i personally think this is the best way as we don't get rid of data when not needed


# Questions

## 1. What are the distributions of the country of all our transactions?
```{r}
new_data = data[!is.na(data$merchant_state),] %>%
  group_by(merchant_state) %>%
  summarize(total = n()) 
kable(new_data[order(desc(new_data$total)),])
```
As we can see above the distribution of the transactions recorded does not spread evenly. We can further see the discrepancy between state by plotting it

```{r}
new_data %>%
  ggplot(aes(reorder(merchant_state,-total),total,fill=total))+
  geom_bar(stat='identity')+
  labs(
    x="Merchant State",
    y="Number of Transaction"
  )
```

So what does this means? This means there are a lot more room for improvement for state like TAS,ACT,NT, and SA 

## 2. What is the distribution of balance for each transaction?

```{r}
balance_plot = data %>%
  filter(!is.na(balance))%>%
  ggplot(aes(balance)) +
  geom_density()+
  geom_vline(aes(xintercept=mean(balance)),color="blue",linetype="dashed")
balance_plot
```

Just like expected, it looks really skewed towards the right side.
But I am curious on what does it looks like if we zoom in on the plot where most transaction are inside it.
Let's see it zoomed in

```{r}
balance_mode = density(data$balance)$x[which.max(density(data$balance)$y)]

balance_plot+
  geom_vline(aes(xintercept = balance_mode))+
  scale_x_continuous(
    breaks = sort(
      c(
        seq(0,20000,10000),
        balance_mode,
        mean(data$balance)
        )
      )
    ,limits = c(0,20000)
  )
```

From the graph above, it looks like most of our transaction has balance around 3000, and since a small number of transaction has much higer balance, the average transaction balance is far beyond most of the transaction which is around 14,700.


## 3. What is the distribution of the merchant, how many transaction each merchant has in average?

Let's create table with merchant id on 1 column and number of transaction of that merchant in another column
```{r}
merchant_trans = data %>%
  filter(!is.na(merchant_id))%>%
  group_by(merchant_id)%>%
  summarise(num_of_transaction = n())
  kable(head(merchant_trans))
```
At a glimpse, it looks like a lot of merchant only have 1 transaction, but to better understand this, let's plot the distribution out with histogram

```{r}
merchant_trans %>%
  ggplot(aes(num_of_transaction))+
  geom_bar()+
  geom_vline(colour="red",xintercept=mean(merchant_trans$num_of_transaction))+
  scale_x_continuous(breaks=sort(c(as.integer(seq(0,10,2)),round(mean(merchant_trans$num_of_transaction),digits = 1))))
  
```

So our guess was correct!! There are a lot more merchant with 1 transaction, which makes the average transaction per merchant to be close to 1, or more precisely 1.3 .

## 4.What is ANZ transaction rate over time looks like? Does it have positive, negative, or neutral trend?

First let's see the range of our date data
```{r}
sprintf("Earliest Record = %s",min(data$date))
sprintf("Latest Record = %s",max(data$date))
```
So, now we know that we have around 3 months worth of data. Since the range of date is not really that big, let's see the transaction rate everyday in table
```{r}
transaction_rate_day = data%>%
  filter(!is.na(date))%>%
  count(date)
kable(head(transaction_rate_day))
```
Let's plot this out

```{r}
transaction_rate_day %>%
  ggplot(aes(date,n))+
  geom_path(colour="red")+
  labs(
    x = "Date",
    y = "Number of Transactions"
         )+
  geom_hline(aes(yintercept=mean(n),colour = "Average"))+
  geom_hline(aes(yintercept=median(n),colour= "Median"))+
  geom_hline(aes(yintercept=quantile(transaction_rate_day$n, c(0.025)),colour="upper bound of 95% confidence interval"))+
  geom_hline(aes(yintercept=quantile(transaction_rate_day$n, c(0.975)),colour="lower bound of 95% confidence interval"))+
  scale_y_continuous(
    breaks = sort(
      c(
        seq(
          min(transaction_rate_day$n), 
          max(transaction_rate_day$n), 
          length.out=6), 
        mean(transaction_rate_day$n),
        median(transaction_rate_day$n),
        quantile(transaction_rate_day$n, c(0.025))[[1]],
        quantile(transaction_rate_day$n, c(0.975))[[1]]
      )
    )
  )
  
```

It seems like the number of transactions fluctuate quite a lot between 100 and 160 with an average of around 132, and median around 136 transaction per day.

Since it fluctuates a lot around the mean, it looks like there is no clear trend. To make sure, let's make a linear model on top of the plot above to show the overall trend !!

```{r}
transaction_rate_day %>%
  ggplot(aes(date,n))+
  geom_path(colour="red")+
  labs(
    x = "Date",
    y = "Number of Transactions"
         )+
  geom_smooth(method="lm", se= FALSE)
```


The blue line right there is the overall trend of the transaction data. So the verdict is that the transaction over this 3 month period does not show any positive or negative trend, or in other words it shows a neutral trend.
